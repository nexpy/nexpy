
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Python Graphical User Interface &#8212; NeXpy 2.0.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinxdoc.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <link rel="shortcut icon" href="_static/favicon.ico"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Adding a File Importer" href="readers.html" />
    <link rel="prev" title="Python Interface to NeXus" href="pythonshell.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="readers.html" title="Adding a File Importer"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="pythonshell.html" title="Python Interface to NeXus"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">NeXpy 2.0.0 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Python Graphical User Interface</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="python-graphical-user-interface">
<h1>Python Graphical User Interface<a class="headerlink" href="#python-graphical-user-interface" title="Permalink to this headline">¶</a></h1>
<p>A PyQT GUI has been created to make it easier to keep track of the
loaded NeXus files and the results of any subsequent analysis. It is
invoked from the command line by:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="n">nexpy</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This assumes that the Python ‘bin’ directory is in your
standard shell path.</p>
</div>
<a class="reference internal image-reference" href="_images/nexpy-gui.png"><img alt="_images/nexpy-gui.png" class="align-center" src="_images/nexpy-gui.png" style="width: 90%;" /></a>
<p>The illustration shows the main features of the GUI:</p>
<dl class="simple">
<dt><strong>1) Tree Pane</strong></dt><dd><p>This contains the tree structure of NeXus or HDF5 files opened in
the File menu, non-NeXus files that have been imported and converted
into the NeXus format using one of the NeXus readers, and NXroot,
NXentry, or NXdata groups added from the shell. Various actions on
the data can be performed by right-clicking a tree item, include
plotting, renaming, fitting and deleting the data.</p>
</dd>
<dt><strong>2) Plot Pane</strong></dt><dd><p>This contains plots produced by (a) the Data:Plot Data menu item,
which operates on the NeXus data selected in the tree, (b)
double-clicking on NeXus data in the tree, or (c) using NeXus data
<code class="docutils literal notranslate"><span class="pre">plot</span></code> methods from the shell. If an NXdata, NXmonitor, or NXlog
group is plotted, the rank, dimensions, and plotting axes are
determined automatically. If the rank of the data is greater than
two, a two-dimensional slice is extracted from the data. The GUI
allows the selection of alternative slices using one of the axis
panels (see below). If an NXfield is selected, the axes can be
chosen from other NXfields in the same group. It is possible to open
other plot windows and switch between them using the Window menu or
keyboard shortcuts (see below).</p>
</dd>
<dt><strong>3) Shell Pane</strong></dt><dd><p>This is an IPython shell, with NeXpy already imported (as * so no
prefixes are necessary), along with NumPy (as ‘np’), Pyplot (as
‘plt’), and Matplotlib (as ‘mpl’). Any assignments to items in the
tree pane are automatically reflected in the tree pane, and new
NXroot or NXentry objects can be added to the tree from the IPython
shell. NeXus data plots commands from the shell will appear in the
plot pane, and Matplotlib commands can be used to modify the plot
characteristics. The shell has enhanced features such as
autocompletion of NeXus dictionaries and attributes and tooltips
containing module docstrings when you open the module parentheses.</p>
</dd>
<dt><strong>4) Axis Panels</strong></dt><dd><p>The tabbed panels below the plot can be used to modify the plots.
The number of panels depends on the rank of the original data. The
‘signal’, ‘x’ and ‘y’ panels have text boxes and sliders for
adjusting the plotting limits. For rank two or more, a projection
panel allows the plotting of projections along different directions,
using the current axis limits. For ranks greater than two, a ‘z’
panel allows the other dimensions to be varied. Finally, the
‘options’ panel provides access to the a number of tools for
modifying the plot and saving/exporting the plotted data.</p>
</dd>
<dt><strong>5) Status Bar</strong></dt><dd><p>The values and attributes of the currently selected item in the tree
are displayed in the status bar.</p>
</dd>
<dt><strong>6) Tooltips</strong></dt><dd><p>The NeXus tree structure of an item in the tree pane will be
displayed as a tooltip when the cursor hovers over it.</p>
</dd>
</dl>
<div class="section" id="nexpy-menu-bar">
<h2>NeXpy Menu Bar<a class="headerlink" href="#nexpy-menu-bar" title="Permalink to this headline">¶</a></h2>
<div class="section" id="file-menu">
<h3>File Menu<a class="headerlink" href="#file-menu" title="Permalink to this headline">¶</a></h3>
<dl>
<dt><strong>New…</strong></dt><dd><p>Creates a new workspace in the tree.</p>
</dd>
<dt><strong>Open…</strong></dt><dd><p>Opens a new NeXus file as read-only. It is possible unlock the file
to allow modifications to the file (see below).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>It is possible to open a file in directly read/write mode
using the keyboard shortcut Ctrl+Shift+O (⌘+⇧+O on a
Mac). Note that any changes to the file tree, using
either the shell or GUI commands, will be automatically
updated in the file.</p>
</div>
</dd>
<dt><strong>Open Recent…</strong></dt><dd><p>Allows one of the 20 most recently opened or saved files to be
opened. Hovering over one of the files in the list shows its
absolute path.</p>
</dd>
<dt><strong>Open Image…</strong></dt><dd><p>Opens an image file and imports the image and any stored metadata
into an NXdata group within a root tree item, called <code class="docutils literal notranslate"><span class="pre">images</span></code>.
This will read TIFF and CBF files if <a class="reference external" href="https://pythonhosted.org/fabio/">FabIO</a> is installed. JPEG, PNG, and
GIF files are imported using <a class="reference external" href="https://pillow.readthedocs.io/">Pillow</a>. RGB(A) images contain
three-dimensional arrays, including color (and transparency) layers,
which can be displayed as two-dimensional images, with the y-axis
inverted according to the usual image convention, using <code class="docutils literal notranslate"><span class="pre">Plot</span>
<span class="pre">RGB(A)</span> <span class="pre">Image</span></code>.</p>
</dd>
<dt><strong>Open Directory…</strong></dt><dd><p>Opens all the HDF5 files stored in the selected directory. It does
not reopen files already loaded into the tree.</p>
</dd>
<dt><strong>Save as…</strong></dt><dd><p>Saves the selected tree item to a new NeXus file.</p>
</dd>
<dt><strong>Duplicate…</strong></dt><dd><p>Makes a copy of the selected item, leaving the original untouched.
If any field in the original tree is too large to be stored in
memory, its data is stored in an HDF5 core memory file until the
tree is saved to a file.</p>
</dd>
<dt><strong>Restore Session</strong></dt><dd><p>Loads all the files that were open at the end of the previous NeXpy
session.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When launching NeXpy, files from the previous session can
be opened using the <code class="docutils literal notranslate"><span class="pre">-r</span></code> switch.</p>
</div>
</dd>
<dt><strong>Reload</strong></dt><dd><p>Reloads the NeXus file. This is useful if another application has
modified the data since originally opening the file.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If an external process has modified the currently loaded
file, the lock icon color is changed to red. If the file
was previously unlocked, its mode is automatically
changed to read-only when the modification is detected.</p>
</div>
</dd>
<dt><strong>Reload All</strong></dt><dd><p>Reloads all open NeXus files that have been modified by extermal processes.</p>
</dd>
<dt><strong>Remove</strong></dt><dd><p>Removes the root item from the NeXpy tree.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This will also remove the item with the same name from
the shell. However, if it had previously been assigned
to another variable with a different name, that
variable will not be deleted.</p>
</div>
</dd>
<dt><strong>Remove All</strong></dt><dd><p>Removes all items from the NeXpy tree.</p>
</dd>
<dt><strong>Collapse Tree</strong></dt><dd><p>Collapses all expanded items in the tree.</p>
</dd>
<dt><strong>Import</strong></dt><dd><p>Imports data from other formats. Some importers are provided with
the NeXpy distribution, but others can be loaded from the user’s
<code class="docutils literal notranslate"><span class="pre">~/.nexpy/readers</span></code> directory or imported from third-party
packages that have defined a <code class="docutils literal notranslate"><span class="pre">nexpy.readers</span></code> entry point.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#importing-nexus-data">Importing NeXus Data</a></p>
</div>
</dd>
<dt><strong>Export</strong></dt><dd><p>Exports data to a NeXus file or, for one-dimensional data, to a
multi-column ASCII file.</p>
</dd>
<dt><strong>Lock File</strong></dt><dd><p>Changes the file access mode to read-only. This will prevent further
changes to the tree using either the GUI or the shell. Locked files
are displayed with a padlock icon.</p>
</dd>
<dt><strong>Unlock File</strong></dt><dd><p>Changes the file access mode to read/write. If the root tree item
has been saved to a file, any subsequent changes will automatically
update the file, including deleting items.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Any changes to an unlocked file will be immediate and
irreversible. If the file contains critical data,
click the checkbox to create a backup, which can be
restored later if necessary.</p>
</div>
</dd>
<dt><strong>Show File Locks</strong></dt><dd><p>If a Lock Directory has been defined, this shows a listing of all
files, whose access is blocked by a current lock file.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="pythonshell.html#file-locking"><span class="std std-ref">File Locking</span></a></p>
</div>
</dd>
<dt><strong>Backup File</strong></dt><dd><p>Creates a backup of the selected file. The backup is stored in the
user’s home directory in <code class="docutils literal notranslate"><span class="pre">~/.nexpy/backups</span></code> and may be restored if
changes to the currently open file need to be reversed. Backups are
saved for five days before being automatically deleted.</p>
</dd>
<dt><strong>Restore Backup…</strong></dt><dd><p>Restores the backup of this file. The user is prompted to confirm
that the currently open file should be overwritten.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This only applies to backups created during the current
session. Previously saved backups can be restored using
the <code class="docutils literal notranslate"><span class="pre">Manage</span> <span class="pre">Backups</span></code> menu item.</p>
</div>
</dd>
<dt><strong>Manage Backups…</strong></dt><dd><p>Provides the ability to restore or delete an existing backup stored
in <code class="docutils literal notranslate"><span class="pre">~/.nexpy/backups</span></code>. Restoring the backup is equivalent to
opening the existing backup file. It is necessary to save it to a
new location to prevent its automatic deletion after five days.</p>
</dd>
<dt><strong>Open Scratch File…</strong></dt><dd><p>Saved projections and fits are stored in a scratch file called
<code class="docutils literal notranslate"><span class="pre">w0.nxs</span></code>, which is stored in the user’s NeXpy directory,
<code class="docutils literal notranslate"><span class="pre">~/.nexpy</span></code>. This file is automatically opened when new data is
saved, but this menu item allows it to be opened at any time.</p>
</dd>
<dt><strong>Purge Scratch File…</strong></dt><dd><p>Previously saved items can be manually removed from the scratch file
when they are no longer needed. This menu item purges all the items
in one go.</p>
</dd>
<dt><strong>Close Scratch File…</strong></dt><dd><p>Closes the scratch file.</p>
</dd>
<dt><strong>Manage Plugins</strong></dt><dd><p>This opens a dialog, in which plugins that have been discovered
within the Python distribution can be enabled or disabled. The order
of the plugins in the menu bar can also be changed.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#nexpy-plugins">NeXpy Plugins</a></p>
</div>
</dd>
<dt><strong>Edit Settings</strong></dt><dd><p>Open a dialog to modify settings for this session. It is also
possible to save them as the default for subsequent sessions.</p>
</dd>
</dl>
</div>
<div class="section" id="edit-menu">
<h3>Edit Menu<a class="headerlink" href="#edit-menu" title="Permalink to this headline">¶</a></h3>
<p>This menu contains editing functions that apply to the IPython shell.</p>
</div>
<div class="section" id="data-menu">
<h3>Data Menu<a class="headerlink" href="#data-menu" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This menu provides a number of functions that can be applied
to the item selected in the tree view. If the function is not available for the selected item, it is not enabled. The same functions are available by right-clicking on the corresponding tree item.</p>
</div>
<dl>
<dt><strong>Plot Data</strong></dt><dd><p>Plots the selected tree item in the plotting pane. If the selected
item is not a valid NXdata, NXmonitor, or NXlog group, a plot dialog
allows the user to specify axes with compatible dimensions to plot
the data against.</p>
</dd>
<dt><strong>Overplot Data</strong></dt><dd><p>Overplots the selected tree item in the plotting pane. This only
works on one-dimensional data.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The new plot is overlaid on the original plot using the
same axis limits. If some of the new data lies outside
the original plotting limits, the slider limits are
increased to cover the expanded range.</p>
</div>
</dd>
<dt><strong>Plot All Signals</strong></dt><dd><p>Plots the main signal and all auxiliary signals if they have been
defined by the selected NXdata group.</p>
</dd>
<dt><strong>Plot Weighted Data</strong></dt><dd><p>Plots the data normalized by the weights array if defined in the
selected NXdata group.</p>
</dd>
<dt><strong>Plot RGB(A) Image</strong></dt><dd><p>Plots the selected tree item as an RGB(A) image. In such images, the
fastest varying dimension, which should be of size 3 or 4, contains
the RGB(A) values for each pixel. By convention, the first pixel is
in the upper-left corner, rather than the lower-left.</p>
</dd>
<dt><strong>View Data</strong></dt><dd><p>Provides a tabular view of the selected item, whether it is a group
or a field. All the metadata associated with the item, including any
attributes, are displayed. For multidimensional data, a 10 x 10 slab
of values is displayed, with spin boxes to select the slab offsets.</p>
<p>If the selected tree item is a group containing scalar fields, they
will be listed in a table. Their values are editable if the file has
been unlocked.</p>
</dd>
</dl>
<dl id="validate-data">
<dt><strong>Validate Data</strong></dt><dd><p>Displays a text window, in which the contents of the selected group
are checked against the NeXus standard. There are options to check
that the group contents conform to the base class or, in the case of
NXentry, NXsubentry, and NXroot groups, to validate the group
contents against an application definition. The definitions are, by
default, stored in the installed package, but it is possible to
select a different definitions directory, as well as a different
application definition file. The XML definition of the group’s base
class can also be displayed.</p>
<a class="reference internal image-reference" href="_images/validation-panel.png"><img alt="_images/validation-panel.png" class="align-center" src="_images/validation-panel.png" style="width: 90%;" /></a>
</dd>
<dt><strong>Add Group</strong></dt><dd><p>Adds a group to the selected group in the tree with the specified
name and base class. A dropdown menu display lists valid base
classes defined by the NeXus standard; those above the dashed line
are valid in the context of the selected tree item, but any of the
other classes can also be selected.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you click on the dropdown menus and hover over any
item, a tooltip gives a description of its use.</p>
</div>
</dd>
<dt><strong>Add Field</strong></dt><dd><p>Adds a field to the selected group in the tree with the specified
name, value, and data type. A dropdown menu can be used to enter
field names that are defined by the NeXus standard, but the user is
free to enter alternative names. The value field can be any valid
Python expression, including NumPy functions such as
<code class="docutils literal notranslate"><span class="pre">np.linspace()</span></code>. Units and long name attributes can also be specified.</p>
</dd>
<dt><strong>Add Attribute</strong></dt><dd><p>Adds an attribute to the selected group or field in the tree with
the specified name, value, and data type. A dropdown menu can be
used to enter attribute names that are defined by the NeXus
standard, but the user is free to enter alternative names. The value
field can be any valid Python expression.</p>
</dd>
<dt><strong>Rename Data</strong></dt><dd><p>Renames the selected tree item. If the item is a group, its class
can also be changed. Dropdown menus provide a list of valid group
classes or field names defined by the NeXus standard.</p>
</dd>
<dt><strong>Copy Data</strong></dt><dd><p>Copies the selected tree item to a copy buffer.</p>
</dd>
<dt><strong>Paste Data</strong></dt><dd><p>Pastes the copy buffer to the selected group. If the selected group
is in a file open with read/write access, all fields in the copy
buffer are copied to the file. If the selected group is not
currently stored in a file and any field in the copy buffer is too
large to be stored in memory, its data is copied to an HDF5
memory-mapped file using the h5py copy module.</p>
</dd>
<dt><strong>Paste As Link</strong></dt><dd><p>Pastes a link to the copied node in the selected group. If the
copied node and the selected group have different roots, the copied
node is added to the group as an external link.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>External links can only be modified through the parent
file, which can be opened using the ‘Show Link’ menu item
(see below).</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The file containing the external link is referenced
using the file path to the parent file. If the files
are moved without preserving their relative file
paths, the link will be broken.</p>
</div>
</dd>
<dt><strong>Delete Data</strong></dt><dd><p>Deletes the selected tree item.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If the item was assigned to another variable in the
shell, that variable will not be deleted.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>If the NeXus tree was loaded from a file with
read/write access, the data will be immediately
deleted from the file. This action is irreversible.</p>
</div>
</dd>
<dt><strong>Show Link</strong></dt><dd><p>Selects the field or group to which the selected item is linked, if
it is an NXlink object, <em>i.e.</em>, shown with a link icon. If the link
is external, the linked file is automatically opened and the linked
object is selected.</p>
</dd>
<dt><strong>Set Signal</strong></dt><dd><p>Sets the plottable signal either to the selected field or to any
field within the selected group. A dialog box allows the user to
specify axes with compatible dimensions to plot the data against.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The use of the ‘Add Data’ and ‘Set Signal’ menu items
allows, in principle, an entire NeXus data tree to be
constructed using menu calls.</p>
</div>
</dd>
<dt><strong>Set Default</strong></dt><dd><p>This sets the <cite>default</cite> attribute in the parent group to the
currently selected group, <em>i.e.</em>, if the selected group is an NXdata
(NXentry) group, the attribute will be set in the parent NXentry
(NXroot) group. The <cite>default</cite> attribute is used to identify the
default data to be plotted.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When a NXdata group is set as the default, the parent
NXentry group is also set as the default in the parent
NXroot group provided one has not already been set. The
default entry can be overridden.</p>
</div>
</dd>
<dt><strong>Fit Data</strong></dt><dd><p>Fits the selected tree item. This assumes that the selected item is
a valid NXdata group. The menu item triggers a dialog box, which
allows functions to be chosen and parameters to be initialized
before calling a non-linear least-squares fitting module.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#fitting-nexus-data">Fitting NeXus Data</a>.</p>
</div>
</dd>
</dl>
</div>
<div class="section" id="view-menu">
<h3>View Menu<a class="headerlink" href="#view-menu" title="Permalink to this headline">¶</a></h3>
<p>This menu contains functions to enter full screen mode and
increase/decrease font sizes.</p>
</div>
<div class="section" id="window-menu">
<h3>Window Menu<a class="headerlink" href="#window-menu" title="Permalink to this headline">¶</a></h3>
<dl>
<dt><strong>Show Tree</strong></dt><dd><p>Brings the tree view to the front and give it keyboard focus.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This has the keyboard shortcut of Ctrl+Shift+T (⌘+⇧+T on
a Mac).</p>
</div>
</dd>
<dt><strong>Show IPython Shell</strong></dt><dd><p>Brings the shell to the front and give it keyboard focus.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This has the keyboard shortcut of Ctrl+Shift+I (⌘+⇧+I on
a Mac).</p>
</div>
</dd>
<dt><strong>Show Log File</strong></dt><dd><p>Opens a text window displaying the NeXpy log file(s). These files,
which are stored in <code class="docutils literal notranslate"><span class="pre">~/.nexpy/nexpy.log</span></code>,
<code class="docutils literal notranslate"><span class="pre">~/.nexpy/nexpy.log.1</span></code>, <em>etc</em>., records operations on the tree
items, as well as comprehensive tracebacks of exceptions in both the
GUI and the IPython shell. Only one-line summaries are displayed in
the shell to improve readability.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The log files contain ANSI markup to colorize the text,
which can be rendered in the terminal using <code class="docutils literal notranslate"><span class="pre">less</span> <span class="pre">-r</span></code>.</p>
</div>
</dd>
<dt><strong>Show Script Editor</strong></dt><dd><p>Shows the script editor. If multiple scripts are open, they are
displayed as tabs in a single window. If no scripts are open, this
will open a new script.</p>
</dd>
<dt><strong>Show Customize Panel</strong></dt><dd><p>This opens a panel for the currently active plotting window that
allows aspects of the plot, such as titles, axis labels, aspect
ratios, skew angles, marker and line colors, and legends to be
customized. All the open panels are displayed as tabs in a single
window.</p>
<a class="reference internal image-reference" href="_images/customize-panel.png"><img alt="_images/customize-panel.png" class="align-center" src="_images/customize-panel.png" style="width: 90%;" /></a>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This is equivalent to clicking the Edit button in the
Options Tab.</p>
</div>
</dd>
<dt><strong>Show Limits Panel</strong></dt><dd><p>This opens a panel for the currently active plotting window that
allows the axes and axis limits of the currently active plot to be
changed, as well as the plot size on the screen. All the panels are
displayed as tabs in a single window, with the option of copying and
values from one tab to the other if the plots are compatible. If the
‘sync’ button is checked, the limits will be synchronized
dynamically to any changes made to the other plot, whether made on
the Limits Panel or directly in the plot. Multiple plots can be
synchronized to a single plot.</p>
<a class="reference internal image-reference" href="_images/limits-panel.png"><img alt="_images/limits-panel.png" class="align-center" src="_images/limits-panel.png" style="width: 90%;" /></a>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When the settings in one tab are copied to another and
the Apply button is clicked, other settings, such as the
aspect ratio, skew angle, color map, and log settings are
also copied. This is therefore a very quick way of making
direct comparisons between different data sets.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The plotting pane in the main window cannot be resized
this way, because of the constraints of the other tree
and shell panes. Other plotting windows will copy the
main window plotting size if requested.</p>
</div>
</dd>
<dt><strong>Show Projection Panel</strong></dt><dd><p>This opens a panel for the currently active plotting window to allow
projections along arbitrary axes to be plotted and/or saved. The
projections are either two-dimensional or, if the y-box is set to
‘None’, one-dimensional. The projections may be plotted in a
separate window, using the ‘Plot’ button or saved to a scratch
NXdata group on the tree. If ‘Sum’ is checked, the projection
contains the sum over all the summed pixels; if not, the projection
contains the average, <em>i.e.</em>, the sum divided by the number of
pixels in each orthogonal dimension. If a one-dimensional projection
is plotted, a checkbox appears allowing additional one-dimensional
projections to be plotted over it.</p>
<p>The x and y limits of the plot are displayed as a dashed rectangle,
which can be hidden if ‘Hide Limits’ is checked. Dragging with the
right-button depressed can be used to change the limits without
replotting.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>On systems without a right mouse button, right-click
dragging can usually be accomplished by other means,
<em>e.g.</em>, two-finger drags on a trackpad or dragging with
the [Ctrl]-key depressed.</p>
</div>
<p>All the open projection panels are displayed as tabs in a single
window, with the option of copying projection values from one tab to
the other if the plots are compatible.</p>
<a class="reference internal image-reference" href="_images/projection-panel.png"><img alt="_images/projection-panel.png" class="align-center" src="_images/projection-panel.png" style="width: 90%;" /></a>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The projection panel can also be used to mask and unmask
data within the dashed rectangle. See <a class="reference internal" href="pythonshell.html"><span class="doc">Python Interface to NeXus</span></a>
for descriptions of masked arrays.</p>
</div>
</dd>
<dt><strong>Show Scan Panel</strong></dt><dd><p>This opens a panel for plotting data across multiple files in the
NeXpy tree. The limits are used to define projection of the
currently plotted data, which is to be plotted against the variable
defined by the path in the Scan field. This path can either be
entered manually, or by selecting a scalar quantity in the tree and
clicking the ‘Select Scan’ button. The ‘Select Files’ button is then
used to define the loaded files to be included in the scan. Values
of the scanned variable are automatically read from the file and
entered in the box by the corresponding file, where they can be
edited if necessary.</p>
<a class="reference internal image-reference" href="_images/scan-panel.png"><img alt="_images/scan-panel.png" class="align-center" src="_images/scan-panel.png" style="width: 90%;" /></a>
</dd>
<dt><strong>Show All Limits</strong></dt><dd><p>This opens the limits panel for every open plot window.</p>
</dd>
<dt><strong>Reset Plot Limits</strong></dt><dd><p>This restores the axis and signal limits to the original values.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This is equivalent to clicking on the Home button in the
Options Tab (see below). Right-clicking within the plot
restores the axis limits but does not reset the signal
limits.</p>
</div>
</dd>
<dt><strong>New Plot Window</strong></dt><dd><p>Opens a new NeXpy plotting window, consisting of a Matplotlib plot
pane and its associated axis panels. NeXpy plot commands will be
directed to the currently active window. Clicking on the plot pane
makes it active. All open windows are listed in the Window menu,
along with their labels (‘Main’, ‘Figure 1’, ‘Figure 2’, <em>etc</em>.).
These are used to switch the focus for subsequent plots.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If Matplotlib windows are opened from the IPython shell
using the standard Pyplot commands, <em>e.g.</em>,
<code class="docutils literal notranslate"><span class="pre">plt.figure()</span></code>, they are numbered independently and
will not be added to the NeXpy menu. They can be modified
using the standard Pyplot commands.</p>
</div>
</dd>
<dt><strong>Close Plot Window</strong></dt><dd><p>Closes the currently active NeXpy plot window.</p>
</dd>
<dt><strong>Equalize Plot Sizes</strong></dt><dd><p>All plot windows are resized to match the main window.</p>
</dd>
<dt><strong>Cascade Plots</strong></dt><dd><p>Repositions all open NeXpy plot windows to cascade from the upper
left corner of the screen to the lower right. This does not apply to
special windows, such as the Projection, Fit, and Rotation windows.</p>
</dd>
<dt><strong>Tile Plots</strong></dt><dd><p>Tiles all open NeXpy plot windows in a grid starting at the upper
left corner moving from left to right, adding extra rows as
necessary. This does not apply to special windows, such as the
Projection, Fit, and Rotation windows.</p>
</dd>
<dt><strong>Main, Figure 1, Figure 2…</strong></dt><dd><p>These menu items set the selected plotting window to be active. As
new windows are created, they are dynamically added to this list.</p>
</dd>
</dl>
</div>
<div class="section" id="script-menu">
<h3>Script Menu<a class="headerlink" href="#script-menu" title="Permalink to this headline">¶</a></h3>
<dl>
<dt><strong>New Script</strong></dt><dd><p>Opens a new script in an editable text window with syntax coloring.
The Python code can be run within the IPython console at any time
using the console namespace. That means that all the items on the
NeXpy tree are also accessible without further imports.</p>
<p>The scripts can be saved for future use from within NeXpy or from
the terminal command line. They can therefore be formatted as a
Python standalone script to be either run as <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">script.py</span></code> or
run in the console (similar to the IPython ‘run magic’, <em>i.e.</em>,
<code class="docutils literal notranslate"><span class="pre">%run</span> <span class="pre">-i</span> <span class="pre">script.py</span></code>). Script arguments can be entered in a
separate text window at the bottom of the window and accessed within
the script in the ‘sys.argv’ list.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Script arguments are just text strings, so if the
argument is a node on the tree, it must be referenced as a tree dictionary item, <em>e.g.</em>, <code class="docutils literal notranslate"><span class="pre">nxtree[sys.argv[1]]</span></code></p>
</div>
<p>Scripts are saved, by default, in <code class="docutils literal notranslate"><span class="pre">~/.nexpy/scripts</span></code>, and are
automatically added to the bottom of the Script Menu.</p>
</dd>
<dt><strong>Open Script</strong></dt><dd><p>Opens an existing Python script file in an editable text window.</p>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The currently selected node in the NeXpy tree can be
referenced in the script as <code class="docutils literal notranslate"><span class="pre">treeview.node</span></code>.</p>
</div>
<dl class="simple">
<dt><strong>Open Startup Script</strong></dt><dd><p>Opens the startup script, <code class="docutils literal notranslate"><span class="pre">~/.nexpy/config.py</span></code>, which is run when
NeXpy is launched. This can be used to customize imports and other
settings that affect the IPython shell.</p>
</dd>
<dt><strong>Public Scripts</strong></dt><dd><p>A tree view of all the scripts stored in the public script
directory. The location of this directory may be defined by the
environment variable <code class="docutils literal notranslate"><span class="pre">NX_SCRIPTDIRECTORY</span></code> or specified in the
<code class="docutils literal notranslate"><span class="pre">Edit</span> <span class="pre">Settings</span></code> dialog.</p>
</dd>
<dt><strong>Private Scripts</strong></dt><dd><p>A tree view of all the scripts stored in the private script
directory located in <code class="docutils literal notranslate"><span class="pre">~/.nexpy/scripts</span></code>.</p>
</dd>
</dl>
</div>
<div class="section" id="help-menus">
<h3>Help Menus<a class="headerlink" href="#help-menus" title="Permalink to this headline">¶</a></h3>
<dl class="simple">
<dt><strong>Open NeXpy Help Online</strong></dt><dd><p>Opens this documentation in a browser.</p>
</dd>
<dt><strong>Open NeXpy API Tutorial Online</strong></dt><dd><p>Opens an online <a class="reference external" href="https://colab.research.google.com/github/nexpy/nexusformat/blob/master/src/nexusformat/notebooks/nexusformat.ipynb">Jupyter notebook</a>
containing a practical tutorial on the <code class="docutils literal notranslate"><span class="pre">nexusformat</span></code> package.</p>
</dd>
<dt><strong>Open NeXus Base Classes Definitions Online</strong></dt><dd><p>Opens online <a class="reference external" href="https://manual.nexusformat.org/classes/base_classes/">documentation on the current NeXus base classes</a>.</p>
</dd>
<dt><strong>Open IPython Help Online</strong></dt><dd><p>Opens online <a class="reference external" href="https://ipython.readthedocs.io/">documentation on IPython</a>.</p>
</dd>
<dt><strong>Open Intro to IPython</strong></dt><dd><p>Outputs an introduction to IPython in the shell. Type ‘q’ to return
to the shell.</p>
</dd>
<dt><strong>IPython Cheat Sheet</strong></dt><dd><p>Outputs the IPython Quick Reference Card in the shell. Type ‘q’ to
return to the shell.</p>
</dd>
<dt><strong>Open Example File</strong></dt><dd><p>Launches a ‘Open File’ dialog allowing one of the example NeXus
files distributed with NeXpy to be opened.</p>
</dd>
<dt><strong>Open Example Script</strong></dt><dd><p>Launches a ‘Open File’ dialog allowing one of the example NeXus
scripts distributed with NeXpy to be opened in the Script Editor.</p>
</dd>
</dl>
</div>
<div class="section" id="other-menus">
<h3>Other Menus<a class="headerlink" href="#other-menus" title="Permalink to this headline">¶</a></h3>
<p>The Edit and View Menus consist of menu items provided by the Jupyter Qt
Console. All these operations act on the shell text.</p>
</div>
</div>
<div class="section" id="adding-nexus-data-to-the-tree">
<h2>Adding NeXus Data to the Tree<a class="headerlink" href="#adding-nexus-data-to-the-tree" title="Permalink to this headline">¶</a></h2>
<p>NXroot groups that are displayed in the tree pane are all children of a
group of class NXtree, known as ‘tree’. If you create a NeXus group
dynamically in the IPython shell, it can be added to the tree pane using
the tree’s add method:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="o">=</span><span class="n">NXroot</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="o">.</span><span class="n">entry</span> <span class="o">=</span> <span class="n">NXentry</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nxtree</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</pre></div>
</div>
<p>If the group is an NXroot group, it will have the name used in the
shell. If the group is not an NXroot group, the data will be wrapped
automatically in an NXroot group and given a default name that doesn’t
conflict with existing tree nodes, <em>e.g.</em>, w4.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The NXroot class is still considered to be the root of the
NeXus tree in shell commands. The NXtree group is only used
by the GUI and cannot be saved to a file.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>In Python, an object may be accessible within the shell
with more than one name. NeXpy searches the shell
dictionary for an object with the same ID as the added
NeXus object and so may choose a different name. The
object in the tree can be renamed.</p>
</div>
</div>
<div class="section" id="plotting-nexus-data">
<h2>Plotting NeXus Data<a class="headerlink" href="#plotting-nexus-data" title="Permalink to this headline">¶</a></h2>
<p>NXdata, NXmonitor, and NXlog data can be plotted by selecting a group on
the tree and choosing “Plot Data” from the Data menu or by
double-clicking the item on the tree (or right-clicking for over-plots).
Below the plot pane, a series of tabs allow manipulation of the plot
limits and parameters using text boxes and sliders.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The slider ranges are initially set by the data limits. You
can redefine the slider ranges by editing their respective
minimum and/or maximum text boxes. The original range can be
restored by clicking on the Home button in the Options Tab or right-clicking within the plot.</p>
</div>
<p><strong>Signal Tab</strong></p>
<blockquote>
<div><a class="reference internal image-reference" href="_images/signal-tab.png"><img alt="_images/signal-tab.png" class="align-center" src="_images/signal-tab.png" style="width: 75%;" /></a>
<p>The signal tab contains text boxes and sliders to adjust the
intensity limits, a checkbox to plot the intensity on a log scale,
and two dropdown menus to select a color palette and a 2D
interpolation method.</p>
<p>The color palettes are divided into three sections, separating
perceptually uniform palettes at the top, miscellaneous palettes,
and diverging palettes at the bottom. See the <a class="reference external" href="http://matplotlib.org/users/colormaps.html">Matplotlib
documentation</a> for
more details.</p>
<p>If a diverging color scale is used, the signal is assumed to be
symmetric about 0, so the minimum box and slider are disabled and
their values set to the negative of the maximum values. If a log
scale is chosen, a <a class="reference external" href="http://matplotlib.org/users/colormapnorms.html#symmetric-logarithmic">symmetric log plot</a>
is displayed, with threshold and scale parameters adjustable using
the command-line <cite>symlog</cite> command (see below).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For a one-dimensional plot, there is no signal tab. The
intensity is adjusted using the y-tab. There is also no
signal tab for an RGB(A) image, since the colors are
defined by the RGB(A) values.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The interpolation methods are the default options
provided by Matplotlib, which are only available for 2D
data with a regular grid.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If the <a class="reference external" href="http://www.astropy.org">astropy</a> module is
installed, the interpolation dropdown menu includes a
<cite>convolve</cite> option. Strictly speaking, this is not an
interpolation method, since it performs a Gaussian
smoothing of the data, with a standard deviation set by
the <cite>smooth</cite> option (see below). The default is 2 pixels.</p>
</div>
</div></blockquote>
<p><strong>X Tab</strong></p>
<blockquote>
<div><a class="reference internal image-reference" href="_images/x-tab.png"><img alt="_images/x-tab.png" class="align-center" src="_images/x-tab.png" style="width: 75%;" /></a>
<p>The x and y-tabs contains text boxes and sliders to adjust the axis
limits and a dropdown menu to select the axis to be plotted along x
or y, respectively. The names correspond to the axis names in the
NXdata group. A checkbox allows the direction of the axes to be
flipped.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Flipping the axis directions does not flip the
direction of the sliders.</p>
</div>
</div></blockquote>
<p><strong>Y Tab</strong></p>
<blockquote>
<div><a class="reference internal image-reference" href="_images/y-tab.png"><img alt="_images/y-tab.png" class="align-center" src="_images/y-tab.png" style="width: 75%;" /></a>
<p>The y-tab has three additions to the features in the x-tab:</p>
<ol class="arabic simple">
<li><p>Since multiple one-dimensional data sets can be plotted on the
same figure, an additional pull-down menu is added on the
left-hand side to select them.</p></li>
<li><p>Selecting the ‘smooth’ checkbox adds a line that smoothly
interpolates one-dimensional data. This uses the <a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.interpolate.interp1d.html">SciPy interp1d
function</a>.
This option is provided to add guides-to-the-eye, and should be
used for numerical analysis with caution.</p></li>
<li><p>The ‘Fit’ button will open a panel for fitting the data using the
<a class="reference external" href="https://lmfit.github.io/lmfit-py/">LMFIT package</a>.</p></li>
</ol>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#fitting-nexus-data">Fitting NeXus Data</a></p>
</div>
</div></blockquote>
<p><strong>Z Tab</strong></p>
<blockquote>
<div><a class="reference internal image-reference" href="_images/z-tab.png"><img alt="_images/z-tab.png" class="align-center" src="_images/z-tab.png" style="width: 90%;" /></a>
<p>If the data rank is three or more, the 2D plot <em>vs</em> x and y is a
projection along the remaining axes. The z-tab sets the limits for
those projections. It contains a dropdown menu for selecting the
axis to be averaged or summed over and two text boxes for selecting
the projection limits. When the data are first plotted, only the top
slice if plotted, <em>i.e.</em>, all the z-axis limits are set to their
minimum value.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Projections are now averaged over the summed bins by
default. To restore the previous behavior, click the
‘Sum’ checkbox in the Projection Tab.</p>
</div>
<p>When ‘Lock’ is checked, the difference between the limits of the
selected z-axis is fixed. This allows successive images along the
z-axis to be plotted by clicking the text-box arrows in increments
of the difference between the two limits. If you use the text-box
arrows or the terminal arrow keys to change the z-limits when they
are locked together, the new plot is updated automatically.
Otherwise, the data is only replotted when you force a replot using
the toolbar (see below).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Make sure that the value of both limit boxes is entered,
<em>e.g.</em>, by pressing return after editing their values,
before clicking on the ‘lock’ checkbox.</p>
</div>
<p>When stepping through the z-values, the ‘Autoscale’ checkbox
determines whether the plot automatically scales the signal to the
maximum intensity of the slice or is set to the current signal
limits.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When ‘Autoscale’ is checked, it is not possible to adjust
the limits in the Signal Tab.</p>
</div>
<img alt="_images/z-toolbar.png" class="align-right" src="_images/z-toolbar.png" />
<p>The toolbar on the right provides further controls for replotting
data as a function of z. The first button on the left forces a
replot, <em>e.g.</em>, when you have changed z-axis limits or turned on
auto-scaling. The other buttons are for stepping through the
z-values automatically, with ‘back’, ‘pause’, and ‘forward’
controls. The default speed is one frame per second, but after the
first click on the play button, subsequent clicks will reduce the
frame interval by a factor two.</p>
</div></blockquote>
<p><strong>Projection Tab</strong></p>
<blockquote>
<div><a class="reference internal image-reference" href="_images/projection-tab.png"><img alt="_images/projection-tab.png" class="align-center" src="_images/projection-tab.png" style="width: 90%;" /></a>
<p>The projection tab allows the Projection, Limits, and Scan panels to
be opened. The aspect ratio and skew angle can be defined and a new
plot window opened containing the currently plotted two-dimensional
data rotated at an arbitrary angle. This allows projections to be
applied along non-orthogonal axes.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For a quick view of rotated data, arbitrary
one-dimensional cuts through the current
two-dimensional plot can be plotted in a new window by
dragging along the required line with the Shift key
depressed. Subsequent cuts will be overplotted in this
window until it is closed.</p>
</div>
<a class="reference internal image-reference" href="_images/rotation-plot.png"><img alt="_images/rotation-plot.png" class="align-center" src="_images/rotation-plot.png" style="width: 90%;" /></a>
</div></blockquote>
<p><strong>Options Tab</strong></p>
<blockquote>
<div><a class="reference internal image-reference" href="_images/options-tab.png"><img alt="_images/options-tab.png" class="align-center" src="_images/options-tab.png" style="width: 90%;" /></a>
<p>The options tab is based on the standard Matplotlib toolbar, with
the the addition of extra buttons. From left to right, the buttons
are:</p>
<ul class="simple">
<li><p><strong>Home</strong> - restores all plotting limits to their original values.</p></li>
<li><p><strong>Arrows</strong> - cycles through the limits of previous plots.</p></li>
<li><p><strong>Pan</strong> - enables panning mode (disabling zoom mode).</p></li>
<li><p><strong>Zoom</strong> - enables zoom mode (disabling pan mode).</p></li>
<li><p><strong>Aspect</strong> - toggles between setting the aspect ratio
automatically to fill the available space or setting the x and y
scales to be equal. This is only valid if the units of the x and y
axes are identical.</p></li>
<li><p><strong>Edit</strong> - opens the Customize Panel to edit both image and point
plots. Use this to change the title and axis labels, modify the
image aspect ratio and skew angles, turn axis grids on or off and
set their styles, modify the point plot markers and lines, scale
or add an offset to 1D plots, and draw legends.</p></li>
<li><p><strong>Modify</strong> - opens the Style Panel that allows the labels and font
sizes of the plot to be adjusted dynamically. The plot margins
can also be changed from the Matplotlib defaults.</p></li>
<li><p><strong>Save</strong> - saves plot to PNG file.</p></li>
<li><p><strong>Export</strong> - exports plotted data to a NeXus file or, for
one-dimensional data, a multi-column ASCII file.</p></li>
<li><p><strong>Add</strong> - adds plotted data to the tree pane as an NXdata group
within the scratch workspace ‘w0’.</p></li>
</ul>
<p>On the far right of the toolbar, the data and axis values are
dynamically updated to the values under the current mouse location.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>See the <a class="reference external" href="https://matplotlib.org/users/navigation_toolbar.html">Matplotlib documentation</a> for more detailed descriptions of the
standard toolbar, including keyboard shortcuts. The
‘Aspect’, ‘Export’, and ‘Add’ buttons are unique to
NeXpy.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The aspect ratio of a plot can also be set from the
IPython shell. See below.</p>
</div>
</div></blockquote>
<p><strong>Command Line Options</strong></p>
<blockquote>
<div><p>It is possible to modify some of the plotting features from the
IPython shell. The current plotting pane, the default Matplotlib
axis instance, and the current image are exposed as <code class="docutils literal notranslate"><span class="pre">plotview</span></code>,
<code class="docutils literal notranslate"><span class="pre">plotview.ax</span></code>, and <code class="docutils literal notranslate"><span class="pre">plotview.image</span></code>, respectively.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Before making any changes, make sure that you have
selected the right plotting pane, either by selecting it
in the Window menu or using one of the keyboard
shortcuts, which are displayed in the menu, <em>e.g.</em>, &lt;Ctrl&gt;
+2 (⌘+2 on a Mac) to select Figure 2.</p>
</div>
</div></blockquote>
<ul>
<li><p>Set Aspect Ratio:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">plotview</span><span class="o">.</span><span class="n">aspect</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">aspect</span><span class="o">&gt;</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">&lt;aspect&gt;</span></code> can be any of the values allowed by the <a class="reference external" href="https://matplotlib.org/stable/api/axes_api.html#aspect-ratio">Matplotlib
set_aspect</a>
function, <em>i.e.</em>, ‘auto’, ‘equal’, or the numerical value of the ratio
between the height and the width (if the units are identical). The
‘Aspect’ button (see above) toggles between ‘auto’ and ‘equal’. This
can also be set using the ‘Edit Parameters’ button on the Options tab.</p>
</li>
<li><p>Set Skew Angle:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">plotview</span><span class="o">.</span><span class="n">skew</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">angle</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>This sets the angle between the x and y-axes in degrees. If set to
<code class="docutils literal notranslate"><span class="pre">None</span></code>, the axes are plotted as orthogonal. If <code class="docutils literal notranslate"><span class="pre">plotview.aspect</span></code>
is currently set to ‘auto’, this command will automatically set it to
1.0 (equivalent to ‘equal’), <em>i.e.</em>, assuming the units of the x and
y-axes are the same. If they are not, <code class="docutils literal notranslate"><span class="pre">plotview.aspect</span></code> should be
set to the ratio of their units. This can also be set using the ‘Edit
Parameters’ button on the Options tab.</p>
</li>
</ul>
<a class="reference internal image-reference" href="_images/skewed-axis.png"><img alt="_images/skewed-axis.png" class="align-center" src="_images/skewed-axis.png" style="width: 75%;" /></a>
<ul>
<li><p>Set Smoothing Width:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">plotview</span><span class="o">.</span><span class="n">smooth</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">stddev</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>This sets the standard deviation in pixels for the Gaussian smoothing
of the data performed when the ‘convolve’ option is selected in the
Signal tab. The default value is 2.</p>
</li>
<li><p>Set Offsets:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">plotview</span><span class="o">.</span><span class="n">offsets</span> <span class="o">=</span> <span class="o">&lt;</span><span class="kc">True</span><span class="o">|</span><span class="kc">False</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>If the range of an axis is much smaller than the absolute values, the
axis labels can overlap. Setting this option will determine whether
Matplotlib converts the axis labels to differences from a fixed offset
value or not. The default is <code class="docutils literal notranslate"><span class="pre">False</span></code>.</p>
</li>
<li><p>Select Color Map:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">plotview</span><span class="o">.</span><span class="n">cmap</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">cmap</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>This allows the color map of the currently displayed image to be
changed. This can be useful if the map is not available in the Signal
Tab. See the <a class="reference external" href="http://matplotlib.org/api/pyplot_api.html#matplotlib.pyplot.set_cmap">Matplotlib documentation</a>
for more details.</p>
</li>
<li><p>Draw Shapes:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">plotview</span><span class="o">.</span><span class="n">vline</span><span class="p">(</span><span class="o">&lt;</span><span class="n">x</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">ymin</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">ymax</span><span class="o">&gt;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plotview</span><span class="o">.</span><span class="n">hline</span><span class="p">(</span><span class="o">&lt;</span><span class="n">y</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">xmin</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">xmax</span><span class="o">&gt;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plotview</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="o">&lt;</span><span class="n">x</span><span class="o">-</span><span class="n">array</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">ymin</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">ymax</span><span class="o">&gt;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plotview</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span><span class="o">&lt;</span><span class="n">y</span><span class="o">-</span><span class="n">array</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">xmin</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">xmax</span><span class="o">&gt;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plotview</span><span class="o">.</span><span class="n">crosshairs</span><span class="p">(</span><span class="o">&lt;</span><span class="n">x</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">y</span><span class="o">&gt;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plotview</span><span class="o">.</span><span class="n">rectangle</span><span class="p">(</span><span class="o">&lt;</span><span class="n">x</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">y</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">dx</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">dy</span><span class="o">&gt;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plotview</span><span class="o">.</span><span class="n">circle</span><span class="p">(</span><span class="o">&lt;</span><span class="n">x</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">y</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">radius</span><span class="o">&gt;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plotview</span><span class="o">.</span><span class="n">ellipse</span><span class="p">(</span><span class="o">&lt;</span><span class="n">x</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">y</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">dx</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">dy</span><span class="o">&gt;</span><span class="p">)</span>
</pre></div>
</div>
<p>These functions draw graphical primitives on the plot using the axis
coordinates. In the case of the lines, the complete range of the plot
will be used if the minimum and maximum values are omitted. The
rectangle coordinates represent the lower left-hand corner but the
circle and ellipse coordinates represent the shape center.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Since the arguments are in the units of the axes, the circle will
only be truly circular if the x and y units are the same, and the
aspect ratio of the plot is equal.</p>
</div>
<p>All of the functions will accept additional keyword arguments used in
drawing Matplotlib shapes, <em>e.g.</em>, to change the edge and fill colors,
line properties, <em>etc</em>. See the <a class="reference external" href="http://matplotlib.org/api/patches_api.html#matplotlib.patches.Polygon">Matplotlib documentation</a>
for more details.</p>
</li>
<li><p>Draw Grid:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">plotview</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="o">|</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<p>Draws grid lines at the major tick values. Additional keyword
arguments can be given to modify the color, linestyle, <em>etc</em>, using
the standard <a class="reference external" href="http://matplotlib.org/api/axes_api.html?highlight=grid#matplotlib.axes.Axes.grid">Matplotlib conventions</a>.</p>
</li>
<li><p>Draw Legend:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">plotview</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="o">*</span><span class="n">items</span><span class="p">,</span> <span class="o">*</span><span class="n">opts</span><span class="p">)</span>
</pre></div>
</div>
<p>This draws a legend using the standard Matplotlib API, <em>i.e.</em>, it is
broadly equivalent to calling <code class="docutils literal notranslate"><span class="pre">plotview.ax.legend()</span></code>. It is only
intended to be used for one-dimensional plots. By default, the labels
will contain the full path to each plotted field, but setting the
keyword argument, <code class="docutils literal notranslate"><span class="pre">nameonly=True</span></code> will restrict the label to the
field name.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Legend labels, positions, and other attributes can be
modified in the Customize Dialog.</p>
</div>
</li>
<li><p>Convert to Symmetric Log Plot:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">plotview</span><span class="o">.</span><span class="n">symlog</span><span class="p">(</span><span class="n">linthresh</span><span class="p">,</span> <span class="n">linscale</span><span class="p">,</span> <span class="n">vmax</span><span class="p">)</span>
</pre></div>
</div>
<p>Plot the data using symmetric logarithms for both positive and
negative data. The <code class="docutils literal notranslate"><span class="pre">linthresh</span></code> and <code class="docutils literal notranslate"><span class="pre">linscale</span></code> parameters are used
to define the linear region interpolating between the positive and
negative log regions. See the <a class="reference external" href="http://matplotlib.org/users/colormapnorms.html#symmetric-logarithmic">Matplotlib documentation</a>
for more details. The maximum and minimum signal values are set to +/-
vmax.</p>
<p>Calling <code class="docutils literal notranslate"><span class="pre">symlog</span></code> will set the <code class="docutils literal notranslate"><span class="pre">linthresh</span></code> and <code class="docutils literal notranslate"><span class="pre">linscale</span></code>
parameters for future plots. Call it without any parameters to set
them to their default values, <code class="docutils literal notranslate"><span class="pre">linthresh=vmax/10</span></code> and
<code class="docutils literal notranslate"><span class="pre">linscale=0.1</span></code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>There are a number of diverging color maps, such as
<code class="docutils literal notranslate"><span class="pre">coolwarm</span></code>, that are ideal for displaying symmetric log
data. Some are available at the bottom of the color map
dropdown menu in the Signal tab.</p>
</div>
</li>
</ul>
<p><strong>Keyboard Shortcuts</strong></p>
<blockquote>
<div><p>A number of keyboard shortcuts are defined when focus is on the
plotting window. These can be used to switch between tabs or set
various plotting options.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Keyboard focus can be switched to a particular plotting
window by (a) clicking within the window, (b) using the Window menu, or (c) typing Ctrl+’n’ (⌘+’n’ on a Mac), where ‘n’ is the plot window number.</p>
</div>
<ul class="simple">
<li><p><strong>s</strong> - switch to the Signal tab.</p></li>
<li><p><strong>x</strong> - switch to the X tab.</p></li>
<li><p><strong>y</strong> - switch to the Y tab.</p></li>
<li><p><strong>z</strong> - switch to the Z tab.</p></li>
<li><p><strong>p</strong> - switch to the Projection tab.</p></li>
<li><p><strong>o</strong> - switch to the Options tab.</p></li>
<li><p><strong>l</strong> - toggle logarithmic signal scale (2D plots only).</p></li>
<li><p><strong>g</strong> - toggle display of major and minor grid.</p></li>
<li><p><strong>G</strong> - toggle display of major grid.</p></li>
<li><p><strong>P</strong> - toggle panning mode (if enabled, zoom mode is disabled).</p></li>
<li><p><strong>Z</strong> - toggle zoom mode (if enabled, pan mode is disabled).</p></li>
<li><p><strong>E</strong> - toggle the aspect ratio between ‘equal’ and ‘automatic’.</p></li>
<li><p><strong>S</strong> - save plot to a graphics file.</p></li>
<li><p><strong>A</strong> - add plotted data to the tree pane.</p></li>
<li><p><strong>O</strong> - open dialog to customize plots.</p></li>
</ul>
</div></blockquote>
</div>
<div class="section" id="configuring-nexpy">
<h2>Configuring NeXpy<a class="headerlink" href="#configuring-nexpy" title="Permalink to this headline">¶</a></h2>
<p>When NeXpy if first launched, a private directory is created in the home
directory, ~/.nexpy/. This is used to store log files, backups, plugins,
and scripts. A configuration file, ~/.nexpy/config.py, is created to
contain Python commands that should be run at the start of every
session.</p>
<p>By default, the configuration file contains a number of imports,
including all the functions and classes defined by the nexusformat
package.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">nexpy</span>
<span class="kn">import</span> <span class="nn">nexusformat.nexus</span> <span class="k">as</span> <span class="nn">nx</span>
<span class="kn">from</span> <span class="nn">nexusformat.nexus</span> <span class="kn">import</span> <span class="o">*</span>
</pre></div>
</div>
<p>This file could also be used to change the default parameters used by
the nexusformat package to define, <em>e.g.</em>, memory limits, maximum loaded
array sizes, file locking, default HDF5 compression, and default string
encodings. See <a class="reference internal" href="pythonshell.html"><span class="doc">Python Interface to NeXus</span></a> for more details.</p>
<p>For convenience, the configuration file also imports a number of other
modules that are commonly used:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">h5py</span> <span class="k">as</span> <span class="nn">h5</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">numpy.ma</span> <span class="k">as</span> <span class="nn">ma</span>
<span class="kn">import</span> <span class="nn">scipy</span> <span class="k">as</span> <span class="nn">sp</span>
<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pylab</span><span class="p">,</span> <span class="n">mlab</span><span class="p">,</span> <span class="n">pyplot</span>
<span class="n">plt</span> <span class="o">=</span> <span class="n">pyplot</span>
</pre></div>
</div>
<p>If you require a different set of imports or prefer alternative
abbreviations, edit the configuration file using``Open Startup
Script…`` in the Script Menu.</p>
</div>
<div class="section" id="fitting-nexus-data">
<h2>Fitting NeXus Data<a class="headerlink" href="#fitting-nexus-data" title="Permalink to this headline">¶</a></h2>
<p>NeXpy makes it easy to fit one-dimensional data using the
<a class="reference external" href="https://lmfit.github.io/lmfit-py/">LMFIT package</a>, with a ‘Fit’ button in
the Y-Tab of every one-dimensional plot.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If multiple data sets are plotted in the same window, the one
to be fit can be selected using the pull-down menu on the far
left of the Y-Tab. Multiple data sets can be selected for
fitting at the same time, each one opening a new tab in the
Fit Panel. Line plots of the models and their components will
be plotted in the same color as the corresponding data.</p>
</div>
<p>Alternatively, choosing ‘Fit Data’ from the Data menu or using the
keyboard shortcut Ctrl+Shift+F (⌘+⇧+F on a Mac), will fit data selected
in the Tree Pane.</p>
<p>Either method opens a dialog window that allows multiple fit models to
be combined, with the option of fixing or limiting parameters. To help
in selecting a model, click on the pull-down menu and the model
description will be displayed as a tooltip when you hover over it.</p>
<a class="reference internal image-reference" href="_images/nexpy-fits.png"><img alt="_images/nexpy-fits.png" class="align-center" src="_images/nexpy-fits.png" style="width: 90%;" /></a>
<p>The fit can be plotted, along with the constituent models in the main
plotting window and the fitting parameters displayed in the Fit Panel.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The data are only fitted within the x-limits of the current
plot. This can be used, for example, to perform piece-wise
fits of multiple peaks before a final fit that combines them
all together.</p>
</div>
<div class="section" id="initializing-parameters">
<h3>Initializing Parameters<a class="headerlink" href="#initializing-parameters" title="Permalink to this headline">¶</a></h3>
<p>LMFIT models often define a function to <em>guess</em> initial parameters from
the data. If multiple peaks are to be fitted, sensible starting
parameters for each one can be determined by moving the x-limits to
cover a single peak when adding the peak model. Then, the x-limits can
be restored before fitting all the peaks together.</p>
</div>
<div class="section" id="masking-data">
<h3>Masking Data<a class="headerlink" href="#masking-data" title="Permalink to this headline">¶</a></h3>
<p>Data points can be masked so that they are excluded from the fit.
Individual points can be removed by double-clicking on the point marker.
A set of x-values can be excluded by right-click dragging over the
required range and then clicking on ‘Mask Data’. Masks can be cleared by
clicking on ‘Clear Masks’.</p>
</div>
<div class="section" id="modifying-constraints">
<h3>Modifying Constraints<a class="headerlink" href="#modifying-constraints" title="Permalink to this headline">¶</a></h3>
<p>Parameters can be fixed or constrained with minimum and maximum limits
in the Fit Panel. However, LMFIT also allows parameters to be bound to
the values of one or more other parameters by algebraic expressions.
These expressions can be defined or modified by clicking on ‘Σ’ button
at the end of the parameter row. Pull-down menus allow parameters from
any of the currently added models to be inserted into these expressions.</p>
</div>
<div class="section" id="composing-models">
<h3>Composing Models<a class="headerlink" href="#composing-models" title="Permalink to this headline">¶</a></h3>
<p>When models are added using the ‘Add Model’ button, they are combined to
produce a composite model, in which they are added together by default.
However, LMFIT allows composite models to be combined using different
operators (add, subtract, multiply, and divide), defined by an algebraic
expression. For example, a BoseFactor model, with temperature its only
parameter, is provided by NeXpy. If it is combined with a peak model,
using the ‘multiply’ operator, it will apply a detailed balance factor
appropriate for modeling quasielastic neutron scattering.</p>
<p>A ‘Compose Model’ button allows the algebraic expression combining the
currently added models to be edited.</p>
<p>It is also possible to combine a subset of models when plotting the
fitted models, by selecting ‘Composite Model’ before clicking ‘Plot
Model’. This allows, for example, several functions representing a
background to be combined before they are plotted.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference external" href="https://lmfit.github.io/lmfit-py/model.html#composite-models-adding-or-multiplying-models">LMFIT Composite Models</a></p>
</div>
</div>
<div class="section" id="saving-the-fit">
<h3>Saving the Fit<a class="headerlink" href="#saving-the-fit" title="Permalink to this headline">¶</a></h3>
<p>The original data, the fitted data, the constituent models, and their
parameters can all be saved to an NXprocess group in the Tree Pane using
the ‘Copy Fit’ or ‘Save Fit’ buttons. If the ‘Copy Fit’ button is used,
the NXprocess group can be pasted into any group in the tree that is
unlocked. If the ‘Save Fit’ button is used, the group is saved to the
scratch group, <code class="docutils literal notranslate"><span class="pre">w0</span></code> and named <code class="docutils literal notranslate"><span class="pre">f1</span></code>, <code class="docutils literal notranslate"><span class="pre">f2</span></code>, <em>etc</em>.</p>
<p>If the NXprocess group is selected in the tree, it can be loaded into
a new fit panel for further refinement. If new data is being fitted, a
<code class="docutils literal notranslate"><span class="pre">Import</span> <span class="pre">Model</span></code> button allows the parameters of an earlier fit to be
loaded when its corresponding NXprocess group is selected in the tree.</p>
</div>
<div class="section" id="closing-the-fit-panel">
<h3>Closing the Fit Panel<a class="headerlink" href="#closing-the-fit-panel" title="Permalink to this headline">¶</a></h3>
<p>If the Fit Panel was opened by clicking the ‘Fit’ button in Y-Tab, line
plots of the models and their components are superposed on the existing
plot window. These line plots will be erased when the corresponding tab
in the Fit Panel is closed. However, if the ‘Apply’ button is clicked
before closing the tab, the line plot representing the combined model
will be preserved until the plot window is closed.</p>
</div>
<div class="section" id="defining-a-model">
<h3>Defining a Model<a class="headerlink" href="#defining-a-model" title="Permalink to this headline">¶</a></h3>
<p>NeXpy makes available any of the models currently supplied by the <a class="reference external" href="https://lmfit.github.io/lmfit-py/builtin_models.html">LMFIT
package</a>, as
well as a couple of extra models added to the NeXpy package, the
OrderParameterModel and the PDFdecayModel. If you wish to construct your
own model, please refer to the LMFIT documentation for more details.</p>
<p>User-defined models can be added as separate files to their private
models directory in <code class="docutils literal notranslate"><span class="pre">~/.nexpy/models</span></code> (new to v0.12.6). As an example,
here is the code for the OrderParameterModel that is distributed with
NeXpy:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">lmfit.model</span> <span class="kn">import</span> <span class="n">Model</span>

<span class="k">class</span> <span class="nc">OrderParameterModel</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;A model to describe the temperature dependence of an order parameter</span>
<span class="sd">    with three Parameters: ``amplitude``, ``Tc``, and ``beta``.</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x; A, Tc, \beta) = A ((Tc - x[x&lt;Tc])/ Tc)^\beta</span>

<span class="sd">    where the parameter ``amplitude`` corresponds to :math:`A`, ``Tc`` to</span>
<span class="sd">    :math:`Tc`, and ``beta`` to :math:`\beta`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="k">def</span> <span class="nf">op</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">amplitude</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">Tc</span><span class="o">=</span><span class="mf">100.0</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
            <span class="n">v</span><span class="p">[</span><span class="n">x</span><span class="o">&lt;</span><span class="n">Tc</span><span class="p">]</span> <span class="o">=</span> <span class="n">amplitude</span> <span class="o">*</span> <span class="p">((</span><span class="n">Tc</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="n">x</span><span class="o">&lt;</span><span class="n">Tc</span><span class="p">])</span><span class="o">/</span> <span class="n">Tc</span><span class="p">)</span><span class="o">**</span><span class="n">beta</span>
            <span class="n">v</span><span class="p">[</span><span class="n">x</span><span class="o">&gt;=</span><span class="n">Tc</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">return</span> <span class="n">v</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">guess</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">negative</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Estimate initial model parameter values from data.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_params</span><span class="p">(</span><span class="n">amplitude</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">Tc</span><span class="o">=</span><span class="n">x</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">beta</span><span class="o">=</span><span class="mf">0.33</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Prior to v0.12.6, NeXpy defined its own system for
generating fitting functions. In v2.0.0, this system is no longer supported. Legacy functions should be converted into valid LMFIT models.</p>
</div>
</div>
</div>
<div class="section" id="importing-nexus-data">
<h2>Importing NeXus Data<a class="headerlink" href="#importing-nexus-data" title="Permalink to this headline">¶</a></h2>
<p>NeXpy can import data stored in a number of other formats, including
SPEC files, TIFF images, and text files, using the <a class="reference external" href="File:Import">File:Import</a> menus. If
a file format is not currently supported, the user can write their own.
The following is an example of a module that reads the original format
and returns NeXus data:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_data</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">libtiff</span> <span class="kn">import</span> <span class="n">TIFF</span>
    <span class="n">im</span> <span class="o">=</span> <span class="n">TIFF</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">im</span><span class="o">.</span><span class="n">read_image</span><span class="p">()</span>
    <span class="n">y</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">z</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">x</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">z</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">NXentry</span><span class="p">(</span><span class="n">NXdata</span><span class="p">(</span><span class="n">z</span><span class="p">,(</span><span class="n">y</span><span class="p">,</span><span class="n">x</span><span class="p">)))</span>
</pre></div>
</div>
<p>This could be run in the shell pane and then added to the tree using:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">nxtree</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">get_data</span><span class="p">(</span><span class="s1">&#39;image.tif&#39;</span><span class="p">))</span>
</pre></div>
</div>
<div class="section" id="existing-readers">
<h3>Existing Readers<a class="headerlink" href="#existing-readers" title="Permalink to this headline">¶</a></h3>
<p>NeXpy is currently distributed with readers for the following format:</p>
<p><strong>SPEC Files</strong></p>
<p>This reader will read multiple SPEC scans from a single SPEC log file,
creating a separate NXentry for each scan. All the columns in each scan
are read into the NXdata group, with the default signal defined by the
last column. Mesh scans are converted to multi-dimensional data, with
axes defined by the scan command. It is possible to plot different
columns once the scans are imported.</p>
<p><strong>TIFF Images</strong></p>
<p>This reader will import most TIFF images, including those with floating
point pixels. This currently uses the <a class="reference external" href="https://pypi.python.org/pypi/tifffile">tifffile</a> module. Use the <code class="docutils literal notranslate"><span class="pre">Open</span>
<span class="pre">Image...</span></code> dialog to use the <a class="reference external" href="https://pythonhosted.org/fabio/">FabIO library</a>.</p>
<p><strong>Image Stack</strong></p>
<p>This reader will read a stack of images, which are readable by <a class="reference external" href="https://pythonhosted.org/fabio/">FabIO</a>, <em>e.g.</em>, TIFF or CBF, into a
three-dimensional NXdata group. The image stack must be stored in
separate files in a single directory, that are grouped with a common
prefix followed by an integer defining the stack sequence.</p>
<p><strong>Text Files</strong></p>
<p>This reader will read ASCII data stored in two or three columns,
containing the x and y values, and, optionally, errors. One or more
header lines can be skipped. A more flexible text importer, allowing the
selection of data from multiple columns, is under development.</p>
</div>
<div class="section" id="defining-a-reader">
<h3>Defining a Reader<a class="headerlink" href="#defining-a-reader" title="Permalink to this headline">¶</a></h3>
<p>It is possible to add a reader to the <a class="reference external" href="File:Import">File:Import</a> menu using the
existing samples as a guide in the nexpy.readers directory. User-defined
import dialogs can be added to their private readers directory in
<code class="docutils literal notranslate"><span class="pre">~/.nexpy/readers</span></code> or installed in third-party packages that have the
<code class="docutils literal notranslate"><span class="pre">nexpy.readers</span></code> entry point defined.</p>
<p>Here is an example of an import dialog:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Module to read in a TIFF file and convert it to NeXus.</span>

<span class="sd">Each importer needs to layout the GUI buttons necessary for defining</span>
<span class="sd">the imported file and its attributes and a single module, get_data,</span>
<span class="sd">which returns an NXroot or NXentry object. This will be added to the</span>
<span class="sd">NeXpy tree.</span>

<span class="sd">Two GUI elements are provided for convenience:</span>

<span class="sd">    ImportDialog.filebox: Contains a &quot;Choose File&quot; button and a text</span>
<span class="sd">                          box. Both can be used to set the path to the</span>
<span class="sd">                          imported file. This can be retrieved as</span>
<span class="sd">                          string using self.get_filename().</span>
<span class="sd">    ImportDialog.close_buttons: Contains a &quot;Cancel&quot; and &quot;OK&quot; button to</span>
<span class="sd">                                close the dialog. This should be</span>
<span class="sd">                                placed at the bottom of all import</span>
<span class="sd">                                dialogs.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">nexusformat.nexus</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">nexpy.gui.importdialog</span> <span class="kn">import</span> <span class="n">NXImportDialog</span>

<span class="n">filetype</span> <span class="o">=</span> <span class="s2">&quot;TIFF Image&quot;</span> <span class="c1">#Defines the Import Menu label</span>

<span class="k">class</span> <span class="nc">ImportDialog</span><span class="p">(</span><span class="n">NXImportDialog</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Dialog to import a TIFF image&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">set_layout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filebox</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">close_buttons</span><span class="p">())</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Import &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">filetype</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">get_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">libtiff</span> <span class="kn">import</span> <span class="n">TIFF</span>
        <span class="n">im</span> <span class="o">=</span> <span class="n">TIFF</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_filename</span><span class="p">())</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">NXfield</span><span class="p">(</span><span class="n">im</span><span class="o">.</span><span class="n">read_image</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;z&#39;</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">NXfield</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">z</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">NXfield</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">z</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">NXentry</span><span class="p">(</span><span class="n">NXdata</span><span class="p">(</span><span class="n">z</span><span class="p">,(</span><span class="n">y</span><span class="p">,</span><span class="n">x</span><span class="p">)))</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="nexpy-plugins">
<h2>NeXpy Plugins<a class="headerlink" href="#nexpy-plugins" title="Permalink to this headline">¶</a></h2>
<p>It is possible to customize NeXpy by adding new menus to the main menu
bar with sub-menus that open GUI dialogs orperform operations that are
specific to a specialized application.</p>
<div class="section" id="installing-plugins">
<h3>Installing Plugins<a class="headerlink" href="#installing-plugins" title="Permalink to this headline">¶</a></h3>
<p>NeXpy plugins are contained within external packages, which are
installed separately. The package metadata should declare an entry point
labelled <code class="docutils literal notranslate"><span class="pre">nexpy.plugins</span></code>, which points to the package module
containing the plugin code. Details of what this code should contain are
given in the next section.</p>
<p>An example package, that is installable using <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span>&#160; <span class="pre">.</span></code> is
available in the NeXpy package examples directory.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The plugin code can also be installed in the user’s home
directory (in <code class="docutils literal notranslate"><span class="pre">~/.nexpy/plugins</span></code>), which will be searched
on startup for any valid plugin modules. These do not have to
be configured as installable packages. However, in v2.0.0,
plugins can no longer be installed into the NeXpy package
itself.</p>
</div>
<p>The “Manage Plugins” dialog, launched from the File menu, allows any
plugins to be enabled/disabled, and their order in the menu bar changed.
Duplicate menu names will not be loaded, but a warning will be added to
the NeXpy log file.</p>
<a class="reference internal image-reference" href="_images/manage-plugins.png"><img alt="_images/manage-plugins.png" class="align-center" src="_images/manage-plugins.png" style="width: 60%;" /></a>
</div>
<div class="section" id="defining-plugins">
<h3>Defining Plugins<a class="headerlink" href="#defining-plugins" title="Permalink to this headline">¶</a></h3>
<p>The modules that are accessed through the plugin menu should be defined
as a Python package, <em>i.e.</em>, by creating a sub-directory that contains
<code class="docutils literal notranslate"><span class="pre">__init__.py</span></code>. This must contain a function, <code class="docutils literal notranslate"><span class="pre">plugin_menu</span></code>, which
returns the name to be added to the top-level NeXpy menu bar, and a list
of tuples, each of which contains the sub-menu name and the
corresponding function triggered by clicking on it.</p>
<p>There is an example package, <code class="docutils literal notranslate"><span class="pre">chopper_plugin</span></code>, in the
<code class="docutils literal notranslate"><span class="pre">nexpy.examples</span></code> directory, to show how plugins should be configured.
It adds a top-level menu item, <code class="docutils literal notranslate"><span class="pre">Chopper</span></code>, that has a couple of
sub-menu items to perform data analysis on the example file,
<code class="docutils literal notranslate"><span class="pre">chopper.nxs</span></code>, which is also distributed with NeXpy.</p>
<p>Here is the structure of the <code class="docutils literal notranslate"><span class="pre">chopper_plugin</span></code> package:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>chopper_plugin:
└── pyproject.toml
└── chopper
    ├── __init.py__
    ├── convert_qe.py
    └── get_ei.py
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If the plugin is stored in <code class="docutils literal notranslate"><span class="pre">~/.nexpy/plugins</span></code>, just include
the <code class="docutils literal notranslate"><span class="pre">chopper</span></code> sub-directory in the above file tree.</p>
</div>
<p>Here is the <code class="docutils literal notranslate"><span class="pre">pyproject.toml</span></code> file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">build</span><span class="o">-</span><span class="n">system</span><span class="p">]</span>
<span class="n">requires</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;setuptools&quot;</span><span class="p">,</span> <span class="s2">&quot;setuptools-scm&quot;</span><span class="p">]</span>
<span class="n">build</span><span class="o">-</span><span class="n">backend</span> <span class="o">=</span> <span class="s2">&quot;setuptools.build_meta&quot;</span>

<span class="p">[</span><span class="n">project</span><span class="p">]</span>
<span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;chopper_plugin&quot;</span>
<span class="n">version</span> <span class="o">=</span> <span class="s2">&quot;1.0.0&quot;</span>
<span class="n">dependencies</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;nexpy&quot;</span>
<span class="p">]</span>

<span class="p">[</span><span class="n">project</span><span class="o">.</span><span class="n">entry</span><span class="o">-</span><span class="n">points</span><span class="o">.</span><span class="s2">&quot;nexpy.plugins&quot;</span><span class="p">]</span>
<span class="n">chopper</span> <span class="o">=</span> <span class="s2">&quot;chopper:plugin_menu&quot;</span>
</pre></div>
</div>
<p>This is sufficient to install the plugin using <code class="docutils literal notranslate"><span class="pre">pip</span></code> and make it
discoverable by NeXpy through <code class="docutils literal notranslate"><span class="pre">nexpy.plugins</span></code> entry point. If the
plugin is embedded within a larger package, adjust the entry point so
that it points to the sub-directory containing the <code class="docutils literal notranslate"><span class="pre">__init__.py</span></code> file
that defines the <code class="docutils literal notranslate"><span class="pre">plugin_menu</span></code> function. For example, if the plugin
modules are contained within the <code class="docutils literal notranslate"><span class="pre">plugins</span></code> sub-directory of
<code class="docutils literal notranslate"><span class="pre">mypackage</span></code>, add the following entry point:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">project</span><span class="o">.</span><span class="n">entry</span><span class="o">-</span><span class="n">points</span><span class="o">.</span><span class="s2">&quot;nexpy.plugins&quot;</span><span class="p">]</span>
<span class="n">plugin_name</span> <span class="o">=</span> <span class="s2">&quot;mypackage.plugins.plugin_name:plugin_menu&quot;</span>
</pre></div>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>Information on defining entry points in external packages
that do not use a <code class="docutils literal notranslate"><span class="pre">pyproject.toml</span></code> file is available in
the <a class="reference external" href="https://setuptools.pypa.io/en/latest/userguide/entry_point.html">Setup Tools documentation</a>.</p>
</div>
<p>Here is the <code class="docutils literal notranslate"><span class="pre">__init__.py</span></code> file, which defines the <code class="docutils literal notranslate"><span class="pre">plugin_menu</span></code> function:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">get_ei</span><span class="p">,</span> <span class="n">convert_qe</span>

<span class="k">def</span> <span class="nf">plugin_menu</span><span class="p">():</span>
    <span class="n">menu</span> <span class="o">=</span> <span class="s1">&#39;Chopper&#39;</span>
    <span class="n">actions</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">actions</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;Get Incident Energy&#39;</span><span class="p">,</span> <span class="n">get_ei</span><span class="o">.</span><span class="n">show_dialog</span><span class="p">))</span>
    <span class="n">actions</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;Convert to Q-E&#39;</span><span class="p">,</span> <span class="n">convert_qe</span><span class="o">.</span><span class="n">show_dialog</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">menu</span><span class="p">,</span> <span class="n">actions</span>
</pre></div>
</div>
<p>The actions define the menu text and the function that gets called when
it is selected. In the example, they are contained within the package as
two files, <code class="docutils literal notranslate"><span class="pre">get_ei.py</span></code> and <code class="docutils literal notranslate"><span class="pre">convert_qe.py</span></code>, but they could also be
in a separately installed package in the Python path.</p>
<p>These files should open a dialog box and perform the required
operations, after which the results can either be saved to a new NeXus
file or saved as modifications to an existing tree item.</p>
<p>For example, <code class="docutils literal notranslate"><span class="pre">get_ei.py</span></code> reads the monitor spectra contained within
the currently selected node on the tree, which should have been
previously loaded. It then calculates the difference between the peak
positions of the two spectra, calculates the incident energy, which is
updated in both the dialog box and, if the <code class="docutils literal notranslate"><span class="pre">Save</span></code> button is pressed,
in the loaded NeXus tree, ready for subsequent analysis.</p>
<p>In the simplest cases, no knowledge of PyQt is required. In the example
below, a grid defines a set of parameters, functions to read those
parameters from the PySide text boxes (here, they are decorated with
<code class="docutils literal notranslate"><span class="pre">&#64;property</span></code>, which means that the function can be called without an
argument), a couple of buttons to activate different parts of the
analysis, and finally the functions themselves:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">nexpy.gui.datadialogs</span> <span class="kn">import</span> <span class="n">GridParameters</span><span class="p">,</span> <span class="n">NXDialog</span>
<span class="kn">from</span> <span class="nn">nexpy.gui.mainwindow</span> <span class="kn">import</span> <span class="n">report_error</span>
<span class="kn">from</span> <span class="nn">nexusformat.nexus</span> <span class="kn">import</span> <span class="n">NeXusError</span>


<span class="k">def</span> <span class="nf">show_dialog</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">dialog</span> <span class="o">=</span> <span class="n">EnergyDialog</span><span class="p">()</span>
        <span class="n">dialog</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">except</span> <span class="n">NeXusError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
        <span class="n">report_error</span><span class="p">(</span><span class="s2">&quot;Getting Incident Energy&quot;</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">EnergyDialog</span><span class="p">(</span><span class="n">NXDialog</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">EnergyDialog</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">select_entry</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="n">GridParameters</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;m1&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">entry</span><span class="p">[</span><span class="s1">&#39;monitor1/distance&#39;</span><span class="p">],</span>
                            <span class="s1">&#39;Monitor 1 Distance&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;m2&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">entry</span><span class="p">[</span><span class="s1">&#39;monitor2/distance&#39;</span><span class="p">],</span>
                            <span class="s1">&#39;Monitor 2 Distance&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;Ei&#39;</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">entry</span><span class="p">[</span><span class="s1">&#39;instrument/monochromator/energy&#39;</span><span class="p">],</span>
                            <span class="s1">&#39;Incident Energy&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;mod&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">entry</span><span class="p">[</span><span class="s1">&#39;instrument/source/distance&#39;</span><span class="p">],</span>
                            <span class="s1">&#39;Moderator Distance&#39;</span><span class="p">)</span>
        <span class="n">action_buttons</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">action_buttons</span><span class="p">((</span><span class="s1">&#39;Get Ei&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_ei</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_layout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">entry_layout</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">grid</span><span class="p">(),</span>
                        <span class="n">action_buttons</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">close_buttons</span><span class="p">(</span><span class="n">save</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Get Incident Energy&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">m1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">entry</span><span class="p">[</span><span class="s1">&#39;monitor1&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">m2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">entry</span><span class="p">[</span><span class="s1">&#39;monitor2&#39;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">m1_distance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;m1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">moderator_distance</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">m2_distance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;m2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">moderator_distance</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">Ei</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;Ei&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">moderator_distance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;mod&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>

    <span class="k">def</span> <span class="nf">get_ei</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">t</span> <span class="o">=</span> <span class="mf">2286.26</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">m1_distance</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ei</span><span class="p">)</span>
        <span class="n">m1_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m1</span><span class="p">[</span><span class="n">t</span><span class="o">-</span><span class="mf">200.0</span><span class="p">:</span><span class="n">t</span><span class="o">+</span><span class="mf">200.0</span><span class="p">]</span><span class="o">.</span><span class="n">moment</span><span class="p">()</span>
        <span class="n">t</span> <span class="o">=</span> <span class="mf">2286.26</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">m2_distance</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ei</span><span class="p">)</span>
        <span class="n">m2_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m2</span><span class="p">[</span><span class="n">t</span><span class="o">-</span><span class="mf">200.0</span><span class="p">:</span><span class="n">t</span><span class="o">+</span><span class="mf">200.0</span><span class="p">]</span><span class="o">.</span><span class="n">moment</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;Ei&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="p">(</span><span class="mf">2286.26</span> <span class="o">*</span>
                                       <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m2_distance</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">m1_distance</span><span class="p">)</span> <span class="o">/</span>
                                       <span class="p">(</span><span class="n">m2_time</span> <span class="o">-</span> <span class="n">m1_time</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span>

    <span class="k">def</span> <span class="nf">accept</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;Ei&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">NeXusError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="n">report_error</span><span class="p">(</span><span class="s2">&quot;Getting Incident Energy&quot;</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">EnergyDialog</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">Python Graphical User Interface</a><ul>
<li><a class="reference internal" href="#nexpy-menu-bar">NeXpy Menu Bar</a><ul>
<li><a class="reference internal" href="#file-menu">File Menu</a></li>
<li><a class="reference internal" href="#edit-menu">Edit Menu</a></li>
<li><a class="reference internal" href="#data-menu">Data Menu</a></li>
<li><a class="reference internal" href="#view-menu">View Menu</a></li>
<li><a class="reference internal" href="#window-menu">Window Menu</a></li>
<li><a class="reference internal" href="#script-menu">Script Menu</a></li>
<li><a class="reference internal" href="#help-menus">Help Menus</a></li>
<li><a class="reference internal" href="#other-menus">Other Menus</a></li>
</ul>
</li>
<li><a class="reference internal" href="#adding-nexus-data-to-the-tree">Adding NeXus Data to the Tree</a></li>
<li><a class="reference internal" href="#plotting-nexus-data">Plotting NeXus Data</a></li>
<li><a class="reference internal" href="#configuring-nexpy">Configuring NeXpy</a></li>
<li><a class="reference internal" href="#fitting-nexus-data">Fitting NeXus Data</a><ul>
<li><a class="reference internal" href="#initializing-parameters">Initializing Parameters</a></li>
<li><a class="reference internal" href="#masking-data">Masking Data</a></li>
<li><a class="reference internal" href="#modifying-constraints">Modifying Constraints</a></li>
<li><a class="reference internal" href="#composing-models">Composing Models</a></li>
<li><a class="reference internal" href="#saving-the-fit">Saving the Fit</a></li>
<li><a class="reference internal" href="#closing-the-fit-panel">Closing the Fit Panel</a></li>
<li><a class="reference internal" href="#defining-a-model">Defining a Model</a></li>
</ul>
</li>
<li><a class="reference internal" href="#importing-nexus-data">Importing NeXus Data</a><ul>
<li><a class="reference internal" href="#existing-readers">Existing Readers</a></li>
<li><a class="reference internal" href="#defining-a-reader">Defining a Reader</a></li>
</ul>
</li>
<li><a class="reference internal" href="#nexpy-plugins">NeXpy Plugins</a><ul>
<li><a class="reference internal" href="#installing-plugins">Installing Plugins</a></li>
<li><a class="reference internal" href="#defining-plugins">Defining Plugins</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="pythonshell.html"
                          title="previous chapter">Python Interface to NeXus</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="readers.html"
                          title="next chapter">Adding a File Importer</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/pythongui.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="readers.html" title="Adding a File Importer"
             >next</a> |</li>
        <li class="right" >
          <a href="pythonshell.html" title="Python Interface to NeXus"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">NeXpy 2.0.0 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Python Graphical User Interface</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright Modified BSD License.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 4.5.0.
    </div>
  </body>
</html>